%p#notice= notice

%p
  %h2
    Results

%p
  %b Poll name:
  = @poll.name

%p
  #{@poll.ballots.cast.count} ballots cast, with #{@poll.ballots.outstanding.count} outstanding

%p#irv-results

  %table
    %caption
      Instant-Runoff Results
    %thead
      %tr
        %td
        %th{:scope => 'col'} Value
    %tbody
      - results = @poll.calculate_irv
      - results[:winners].each_with_index do |r, index|
        %tr
          %td #{index + 1}
          %th{:scope => 'row'}= r[:original]

  #log
    = results[:log].gsub("\n", "<br \>").html_safe

%p#borda-results
  - results = @poll.calculate_borda

  %table#borda-results
    %caption
      Borda results
    %thead
      %tr
        %td
        %th{:scope => 'col'} Value
    %tbody
      - results.each do |r|
        %tr
          %th{:scope => 'row'} #{r[1][:original]} 
          %td #{"%.1f" % (r[1][:tally]*100)}

  = render :partial => "pie_chart", :locals => {:data => results.collect{|a| [a[1][:original], a[1][:tally]]}, :name => "borda"}


%p
  = link_to "Return to My Ballot", vote_on_ballot_path(:poll_id => @poll.id, :ballot_key => @ballot.key)

